## EBS(Elastic Block Store) 개요

- 인스턴스가 실행 중인 동안 연결 가능한 네트워크 드라이브
  - network USB과 같다.
- 인스턴스가 종료된 후에도 데이터를 지속할 수 있다.
  - EBS 볼륨을 사용하는 목적
  - 인스턴스를 재생성 후, 이전 EBS 볼륨을 마운트하면 데이터를 다시 받을 수 있다.
- CCP 레벨의 EBS 볼륨은 하나의 EC2 인스턴스에만 마운트 가능
  - 어소시에이트 레벨은 일부 EBS 다중 연결
- EBS 볼륨은 특정한 가용 영역에 고정되어 있음
  - ex) us-east-1a에서 생성된 경우 us-east-1b에는 연결이 불가능
  - 스냅샷을 이용하면 다른 가용 영역으로 옮길 수 있다.
- 네트워크 드라이브이므로 인스턴스와 EBS 볼륨이 서로 통신하기 위해서는 네트워크를 필요로 한다.
  - 통신 지연이 생길 수 있다.
  - EC2 인스턴스에서 분리되고 매우 빠르게 다른 인스턴스에 연결될 수 있다.
- 볼륨이기 때문에 용량을 미리 결정해야 한다.
  - 원하는 GB의 양
  - IOPS (단위 초당 전송 수)
- EC2 인스턴스를 통해 EBS 볼륨을 생성하는 경우 종료 시 삭제라는 속성이 있다. - EC2 인스턴스 종료 시 EBS 행동을 제어할 수 있다. - 기본적으로 루트 EBS 볼륨은 인스턴스 종료와 함께 삭제되도록 설정

<br>
<br>

## EBS 스냅샷

- EBS 스냅샷 : EBS 볼륨의 특정 시점에 대한 백업
- EBS 스냅샷은 다른 가용 영역이나 다른 리전에 복사할 수 있음
- EBS 스냅샷 아카이브 → 최대 75%까지 저렴한 아카이브 티어로 스냅샷을 옮길 수 있는 기능
  - 스냅샷을 아카이브 티어로 옮기면 아카이브를 복원하는데 24시간에서 최대 72시간이 걸린다.
- EBS 스냅샷 휴지통 → EBS 스냅샷을 삭제하는 경우, 삭제 대신에 휴지통에 넣어 향후 복원시킬 수 있음
  - 휴지통에 보관하는 기간은 1일~1년 사이로 설정 가능
- 빠른 스냅샷 복원(FSR) → 스냅샷을 완전 초기화해 첫 사용에서의 지연 시간을 없애는 기능
  - 스냅샷이 아주 크고 EBS 볼륨이나 EC2 인스턴스를 빠르게 초기화해야 할 때 유용
  - 비용이 많이 듬

<br>
<br>

## AMI(Amazon Machine Image)

- EC2 인스턴스를 통해 만든 이미지를 통칭함
- AMI로 AWS를 구축할 수 있고, 마음대로 커스텀할 수도 있다.
  - 원하는 소프트웨어나 설정파일을 추가
  - 별도의 OS를 설치
  - 모니터링 툴 추가
  - 부팅 및 설정에 드는 시간을 단축시킬 수 있다.

### AMI 프로세스

- EC2 인스턴스를 원하는 대로 커스텀한다.
- 인스턴스를 중지해 데이터 무결성을 확보한다.
- 이 인스턴스를 바탕으로 AMI를 구축한다.
  - 이 과정에서 EBS 스냅샷이 생성된다.
- 다른 AMI에서 인스턴스를 생성할 수 있다.

<br>
<br>

## EC2 인스턴스 스토어

- EC2 인스턴스 스토어 : 해당하는 물리적 서버에 연결된 하드웨어 드라이브를 가리킴
- I/O 성능 향상을 위해 활용 가능하다.
- EC2 인스턴스(인스턴스 스토어)를 중지 또는 종료하면 해당 스토리지 또한 손실된다.
  - 임시 스토어라고도 불림
- 버퍼, 캐시, 스크래치 데이터, 임시 콘텐츠를 사용하려는 경우 좋음
- 장기 스토리지의 경우 EBS가 적합
- EC2 인스턴스가 연결된 하드웨어에도 장애가 발생하므로 데이터 손실에 대한 위험이 존재한다.

<br>
<br>

## EBS 볼륨 유형

- gp2, gp3 → 범용 SSD 볼륨
  - 다양한 워크로드에 대해 가격과 성능의 절충안이 되어 줌
- io1, io2 → 최고 성능의 SSD 볼륨
  - 미션 크리티컬이자 지연 시간이 낮고 대용량의 워크로드에 쓰임
- st1 → 저비용 HDD 볼륨
  - 잦은 접근과 처리량이 많은 워크로드에 쓰임
- sc1 → 가장 비용이 적게 드는 HDD 볼륨
  - 접근 빈도가 낮은 워크로드에 쓰임
- EC2 인스턴스에는 gp1, gp3, io1, io2 만이 부팅 볼륨으로 사용될 수 있다.

<br>
<br>

## EBS 다중 연결

- 다중 연결은 하나의 EBS 볼륨을 같은 가용 영역에 있는 여러 EC2 인스턴스에 연결할 수 있게 해 준다.
  - io1, io2 제품군에서만 사용 가능한 기능
- 각 인스턴스는 고성능 볼륨에 대한 읽기 및 쓰기 권한을 모두 갖는다.
  - 동시에 읽고 쓰기가 가능하다.
- 동일한 가용영역 내에서만 사용할 수 있다.
- 한번에 16개의 EC2 인스턴스만 같은 볼륨에 연결 가능
- 다중 연결을 실행하려면 반드시 클러스터 인식 파일 시스템을 사용해야 한다.

<br>

### 사용사례

- 애플리케이션 가용성을 높이기 위해 Teradata처럼 클러스터링된 Linux 애플리케이션에서 사용
- 애플리케이션이 동시 쓰기 작업을 관리해야 할 때 사용

<br>
<br>

## EBS 볼륨 암호화

### EBS 볼륨을 생성하면 일어나는 일

- 저장 데이터가 볼륨 내부에 암호화
- 인스턴스와 볼륨 간의 전송 데이터도 암호화
- 스냅샷 뿐만 아니라 스냅샷으로 생성한 볼륨도 모두 암호화

<br>

### EBS 볼륨 암호화

- 볼륨의 EBS 스냅샷을 생성하고, 복사 기능을 통해 EBS 스냅샷을 암호화 함
- 스냅샷을 이용해 새로운 EBS를 생성하면, 해당 볼륨도 암호화 된다.

<br>
<br>

## Amazon EFS (Elastic File System)

- 관리형 네트워크 파일 시스템
- 여러 EC2 인스턴스에 마운트 될 수 있고, 이 EC2 인스턴스들은 여러 가용 영역에 있을 수 있다.
- 가용성이 높고 확장성도 높다.
- 가격이 비쌈 (gp2 EBS 볼륨의 3배)
- 사용사례 : 콘텐츠 관리, 서버, 데이터 공유 WordPress
- 내부적으로는 NFS 프로토콜을 사용하고, EFS에 대한 액세스를 제어하기 위해서는 보안 그룹을 설정해야 한다.
- Linux 기반 AMI와만 호환된다.
- KMS를 사용해 EFS 드라이브에 저장 데이터 암호화를 활성화 할 수 있다.
- Linux의 표준 파일 시스템 (POSIX 시스템)
- 파일 시스템이 자동으로 확장되고 사용량에 따라 요금을 지불하는 형식 (사용한 GB당 데이터 비용을 지불)

<br>

### EFS 성능

- 수천 개의 NFS 클라이언트에서 EFS에 동시 액세스가 가능하도록 확장됨
- 처리량은 초당 10GB

<br>

### 성능모드

- 범용 모드 (기본 설정)
  - 지연 시간에 민감한 웹 서버, CMS와 같은 사용 사례에 사용
  - I/O를 최대화하고 싶다면 [최대 I/O]를 사용
    - 지연 시간, 처리량 병렬 처리 성능이 향상
    - 파일 시스템에 빅 데이터나 미디어 처리 작업이 있을 때 유용
- 처리량 모드
  - 버스팅 모드 : 1TB 파일 시스템의 데이터 전송 속도는 초당 약 50MiB이며, 초당 100MiB까지 버스트 가능
  - 프로비저닝 모드 : 버스팅 모드에서는 사용 공간이 많을수록 버스팅 용량과 처리량이 늘어나는데, 프로비저닝 모드에서는 스토리지 크기에 상관없이 처리량을 설정할 수 있다
  - 엘라스틱 모드 : 워크로드에 따라 처리량을 자동으로 조절할 수 있다. 워크로드를 예측하기 어려울 때 유용함

<br>

### 스토리지 클래스

- Standard 계층 : 액세스가 빈번한 파일이 있는 계층
- EFS-IA(Infrequent Access) 계층 : 파일을 검색할 경우 비용 발생, 저장하는 비용이 낮음
  - EFS-IA를 활성화하려면 수명 주기 정책을 사용해야 한다.

<br>

### 가용성, 내구성 옵션

- Standard 옵션: EFS를 다중 AZ에 설정
  - 프로덕션 사용 사례에 적합
  - 한 가용 영역이 중단되도, EFS 파일 시스템에 영향을 주지 않음
- One Zone: 하나의 AZ에 설정, 기본적으로 백업이 활성화
  - 개발할 때 좋은 옵션
  - EFS-IA 스토리지 계층과 호환 됨 (EFS One Zone-IA)

<br>
<br>

## EBS vs EFS

### EBS

- 한번에 하나의 인스턴스에만 연결 가능 (다중연결 옵션은 제외)
- 특정 가용 영역에 한정됨
- 가용영역을 옮기려면 스냅샷을 찍고, 다른 가용 영역에서 스냅샷을 복원해야 함
  - 스냅샷이나 백업을 할때는 볼륨 내의 IO를 전부 사용하게 되니, 인스턴스가 EBS를 사용 중이 아닐 때에만 실행해야 한다.

<br>

### EFS

- 여러 가용 영역에 걸쳐 많은 인스턴스들에 연결될 수 있다.
- EFS Mount Target을 사용해 특정 AZ에서 EC2 인스턴스들과 EFS 드라이브를 연결해 줄 수 있다.
- 사용한 만큼만 비용이 청구됨
